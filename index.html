<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP Request Tester</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js" integrity="sha512-nIICeJ2T9j4YKD5cERs2wS9WoT2z4FclObGHTYhA7OeAxtIsjKw77ezXz4gTf1NUz/6HZZB8Mn26GQ4qQzDaw==" crossorigin="anonymous"></script>
</head>
<body>
    <h1>HTTP Request Tester</h1>

    <div>
        <label for="url">URL:</label>
        <input type="text" id="url" placeholder="Enter URL" required>
    </div>

    <div>
        <label for="method">Method:</label>
        <select id="method">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
            <option value="PATCH">PATCH</option>
        </select>
    </div>

    <div>
        <label for="headers">Headers (JSON):</label>
        <div id="headersEditor" style="height: 150px; width: 100%;"></div>
    </div>

    <div>
        <label for="body">Body:</label>
        <div id="bodyEditor" style="height: 150px; width: 100%;"></div>
    </div>

    <button id="sendRequest">Send Request</button>
    <div id="status"></div>
    <div>
        <label for="response">Response:</label>
        <div id="responseEditor" style="height: 150px; width: 100%;"></div>
    </div>

    <script>
        // Initialize Ace editors
        const headersEditor = ace.edit("headersEditor");
        headersEditor.setTheme("ace/theme/github");
        headersEditor.session.setMode("ace/mode/json");
        headersEditor.setValue('{}', 1);

        const bodyEditor = ace.edit("bodyEditor");
        bodyEditor.setTheme("ace/theme/github");
        bodyEditor.session.setMode("ace/mode/json");
        bodyEditor.setValue('{}', 1);

        const responseEditor = ace.edit("responseEditor");
        responseEditor.setTheme("ace/theme/github");
        responseEditor.session.setMode("ace/mode/json");
        responseEditor.setReadOnly(true);

        document.getElementById('sendRequest').onclick = sendRequest;

        async function sendRequest() {
            const url = document.getElementById('url').value;
            const method = document.getElementById('method').value;
            const headers = JSON.parse(headersEditor.getValue());
            let body;

            if (method === "POST" || method === "PUT" || method === "PATCH") {
                body = bodyEditor.getValue();
            }

            const params = getQueryParams();
            const finalUrl = new URL(url);

            // Append query params to the URL
            Object.entries(params).forEach(([key, value]) => {
                if (key && value) {
                    finalUrl.searchParams.append(key, value);
                }
            });

            try {
                const response = await fetch(finalUrl.toString(), {
                    method: method,
                    headers: headers,
                    body: method === "GET" ? null : body
                });

                const contentType = response.headers.get("content-type");

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                if (contentType && contentType.includes("application/json")) {
                    const responseData = await response.json();
                    document.getElementById('status').innerHTML = `
                        <span class="status success">Status: ${response.status}</span>
                    `;
                    responseEditor.setValue(JSON.stringify(responseData, null, 4));
                } else {
                    const responseText = await response.text(); // Get the response as text
                    document.getElementById('status').innerHTML = `
                        <span class="status error">Non-JSON response received. Status: ${response.status}</span>
                    `;
                    responseEditor.setValue(responseText); // Display the response text
                }
            } catch (error) {
                document.getElementById('status').innerHTML = `
                    <span class="status error">Error: ${error.message}</span>
                `;
                responseEditor.setValue('');
            }
        }

        function getQueryParams() {
            const params = {};
            const queryParamInputs = document.querySelectorAll('input[data-query-param]');
            queryParamInputs.forEach(input => {
                const key = input.dataset.queryParam;
                const value = input.value;
                if (key) {
                    params[key] = value;
                }
            });
            return params;
        }
    </script>
</body>
</html>
